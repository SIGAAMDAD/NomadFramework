# This is a PowerShell script for Windows Git hooks
Write-Host "Running pre-commit tests..." -ForegroundColor Cyan

# Get the solution file
$solution = Get-ChildItem -Filter *.slnx | Select-Object -First 1
if (-not $solution) {
    Write-Host "No .sln file found. Skipping tests." -ForegroundColor Yellow
    exit 0
}

# Restore packages
Write-Host "Restoring NuGet packages..." -ForegroundColor Gray
& dotnet restore $solution.FullName
if ($LASTEXITCODE -ne 0) { 
    Write-Host "❌ Package restore failed" -ForegroundColor Red
    exit 1 
}

# Build solution
Write-Host "Building solution..." -ForegroundColor Gray
& dotnet build $solution.FullName --configuration Debug --no-restore --verbosity minimal
if ($LASTEXITCODE -ne 0) { 
    Write-Host "❌ Build failed" -ForegroundColor Red
    exit 1 
}

# Run tests
Write-Host "Running tests..." -ForegroundColor Gray
& dotnet test $solution.FullName --configuration Debug --no-build --verbosity normal

if ($LASTEXITCODE -ne 0) {
    Write-Host "❌ Tests failed! Commit aborted." -ForegroundColor Red
    Write-Host "To skip tests: git commit --no-verify" -ForegroundColor Yellow
    exit 1
}

Write-Host "✅ All tests passed!" -ForegroundColor Green
exit 0